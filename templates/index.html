<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Voice Recorder</title>
    <style>
        body {
            background-color: black;
            color: white;
            text-align: center;
            font-family: sans-serif;
            padding: 2rem;
        }
        button {
            margin: 1rem;
            padding: 0.5rem 1rem;
            font-size: 1rem;
        }
        #status {
            margin-top: 1rem;
        }
    </style>
</head>
<body>
<h1>Voice Recorder</h1>
<button id="start">Start Recording</button>
<button id="stop" disabled>Stop Recording</button>
<p id="status">Not recording</p>

<script>
    let mediaRecorder;
    let chunks = [];

    const startBtn = document.getElementById("start");
    const stopBtn = document.getElementById("stop");
    const statusText = document.getElementById("status");

    startBtn.onclick = async () => {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream);
        mediaRecorder.start();
        statusText.textContent = "Recording...";

        mediaRecorder.ondataavailable = e => {
            chunks.push(e.data);
        };

        mediaRecorder.onstop = async () => {
            const blob = new Blob(chunks, { type: "audio/webm" });
            const formData = new FormData();
            formData.append("file", blob, "recording.webm");

            statusText.textContent = "Uploading...";
            try {
                const res = await fetch("http://127.0.0.1:8000/upload-audio", {
                    method: "POST",
                    body: formData
                });
                const data = await res.json();
                statusText.textContent = `Uploaded: ${data.filename} (${data.size} bytes)`;
            } catch (err) {
                statusText.textContent = "Upload failed!";
                console.error(err);
            }

            chunks = [];
        };

        startBtn.disabled = true;
        stopBtn.disabled = false;
    };

    stopBtn.onclick = () => {
        mediaRecorder.stop();
        startBtn.disabled = false;
        stopBtn.disabled = true;
    };
</script>
</body>
</html>
